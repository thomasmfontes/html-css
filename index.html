const visor = document.getElementById('result');
const botoes = document.querySelectorAll('.btn');

let entradaAtual = '';
let operador = '';
let primeiroNumero = '';
let limparVisor = false;

// Adiciona evento de clique para cada botão
botoes.forEach(botao => {
  botao.addEventListener('click', () => tratarEntrada(botao.value));
});

function tratarEntrada(valor) {
  if (!isNaN(valor)) {
    adicionarNumero(valor);
  } else if (['+', '-', 'x', '/'].includes(valor)) {
    definirOperador(valor);
  } else if (valor === '=') {
    calcularResultado();
  } else if (valor === 'C') {
    limparTudo();
  } else if (valor === '.') {
    adicionarPonto();
  }
}

function adicionarNumero(numero) {
  if (limparVisor) {
    visor.value = '';
    limparVisor = false;
  }
  visor.value += numero;
}

function adicionarPonto() {
  if (limparVisor) {
    visor.value = '0';
    limparVisor = false;
  }
  // Evita ponto duplo no mesmo número
  const ultimaParte = visor.value.split(/[\+\-x\/]/).pop();
  if (!ultimaParte.includes('.')) {
    visor.value += '.';
  }
}

function definirOperador(simbolo) {
  if (visor.value === '') return;
  if (operador) return; // Evita múltiplos operadores seguidos
  primeiroNumero = visor.value;
  operador = simbolo;
  visor.value += ` ${simbolo} `;
  limparVisor = false;
}

function calcularResultado() {
  if (!operador || !visor.value.includes(operador)) return;

  const partes = visor.value.split(` ${operador} `);
  const num1 = parseFloat(partes[0]);
  const num2 = parseFloat(partes[1]);

  let resultado = 0;
  switch (operador) {
    case '+': resultado = num1 + num2; break;
    case '-': resultado = num1 - num2; break;
    case 'x': resultado = num1 * num2; break;
    case '/': resultado = num2 !== 0 ? num1 / num2 : 'Erro'; break;
  }

  visor.value = resultado === 'Erro' ? resultado : (resultado % 1 === 0 ? resultado : resultado.toFixed(2));

  operador = '';
  primeiroNumero = '';
  limparVisor = true;
}

function limparTudo() {
  visor.value = '';
  entradaAtual = '';
  operador = '';
  primeiroNumero = '';
  limparVisor = false;
}

// Suporte para teclado
document.addEventListener('keydown', (evento) => {
  const tecla = evento.key;
  if (!isNaN(tecla)) adicionarNumero(tecla);
  else if (['+', '-', '*', '/'].includes(tecla)) definirOperador(tecla === '*' ? 'x' : tecla);
  else if (tecla === 'Enter' || tecla === '=') calcularResultado();
  else if (tecla === '.') adicionarPonto();
  else if (tecla === 'Backspace') visor.value = visor.value.slice(0, -1);
  else if (tecla.toLowerCase() === 'c') limparTudo();
});
